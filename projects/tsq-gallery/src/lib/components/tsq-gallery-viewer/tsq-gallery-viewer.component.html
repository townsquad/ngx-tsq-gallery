<div id="tsq-gallery-viewer"
     #backdrop
     [ngStyle]="{display: isViewerOpen ? 'flex' : 'none'}"
     (click)="backdropClickClose && !showLoading && close()"
     (keyup)="onKeyUp($event)"
     *ngIf="isViewerOpen"
     [@fadeInOut]
     tabindex="0">

  <div class="viewer-top" *ngIf="!!selectedFileToDisplay">
    <ng-container *ngTemplateOutlet="topViewerTemplate; context: topViewerContext"></ng-container>

    <div class="viewer-top-default"
         *ngIf="!topViewerTemplate">
      <div>{{selectedFileToDisplay.name}}</div>
      <div *ngIf="files.length > 1">{{selectedFileIndex +1}} / {{files.length}}</div>
      <div>
        <div (click)="$event.stopPropagation(); canZoomIn() && zoomIn()"
             [class.disabled]="!canZoomIn()"
             class="pointer-cursor action">&oplus;</div>
        <div (click)="$event.stopPropagation(); canZoomOut() && zoomOut()"
             [class.disabled]="!canZoomOut()"
             class="pointer-cursor action">&#8854;</div>
        <div (click)="$event.stopPropagation(); turnLeft()"
             class="pointer-cursor action" style="font-size: 17px">&#8634;</div>
        <div (click)="$event.stopPropagation(); turnRight()"
             class="pointer-cursor action" style="font-size: 17px; transform: scaleX(-1);">&#8634;</div>
        <div (click)="$event.stopPropagation(); close()"
             class="pointer-cursor action" style="margin-top: -7px; font-size: 22px;">&times;</div>
      </div>
    </div>
  </div>

  <ng-container *ngIf="!!files && !!selectedFileToDisplay">
    <div class="viewer-container">
      <div class="viewer-body"
           [class.navigation]="displayNavigation">
        <div *ngIf="displayNavigation" class="nav-action" [class.disabled]="!canGoBack()" (click)="$event.stopPropagation(); canGoBack() && goBack()">&lsaquo;</div>

        <img [ngStyle]="{'transform': 'rotateZ('+imageRotation+'deg) scale('+imageZoom+')'}"
             *ngIf="selectedFileToDisplay.type === 'image'"
             draggable="false"
             (mousedown)="dragDown($event)"
             (mouseup)="dragUp($event)"
             (mouvemove)="dragMove($event)"
             [src]="selectedFileToDisplay.displayUrl"
             [alt]="selectedFileToDisplay.displayAlt">

        <div class="pdf-container"
             [ngStyle]="{'transform': 'rotateZ('+imageRotation+'deg) scale('+imageZoom+')'}"
             *ngIf="selectedFileToDisplay.type === 'pdf'">
          <pdf-viewer [src]="selectedFileToDisplay.displayUrl"
                      [original-size]="false"
                      [autoresize]="true"
                      [render-text]="true"></pdf-viewer>
        </div>

        <div *ngIf="displayNavigation" class="nav-action" [class.disabled]="!canGoFoward()" (click)="$event.stopPropagation(); canGoFoward() && goFoward()">&rsaquo;</div>
      </div>
    </div>
  </ng-container>

  <div class="viewer-bottom" *ngIf="!!selectedFileToDisplay">
    <ng-container *ngTemplateOutlet="bottomViewerTemplate; context: bottomViewerContext"></ng-container>
  </div>

  <div *ngIf="showLoading" class="viewer-loader">
    <ng-container *ngTemplateOutlet="loadingTemplate"></ng-container>

    <div *ngIf="!loadingTemplate"
         id="default-loader"
         class="lds-ring">
      <div></div>
      <div></div>
      <div></div>
      <div></div>
    </div>
  </div>
</div>
